<?xml version="1.0"?>


<launch>

  <node pkg="cob_3d_mapping_common" type="keyframe_detector_node" name="keyframe_detector_node" output="screen">
    <remap from="camera_info" to="/cam3d/rgb/camera_info"/>

    <param name="r_limit_" type="double" value="0.013" />
    <param name="p_limit_" type="double" value="0.013" />
    <param name="y_limit" type="double" value="0.013" />
    <param name="distance_limit_" type="double" value="0.025"/>
    <param name="trigger_always" type="bool" value="false"/>
  </node>

  <!-- Start registration point map -->
  <arg name="start_manager" default="true"/>
  <arg name="nodelet_manager" default="registration_manager"/>
  <arg name="points_in" default="/cam3d/depth_registered/points"/>
  <!-- start nodelet manager -->
  <node if="$(arg start_manager)" pkg="nodelet" type="nodelet" name="$(arg nodelet_manager)"  args="manager" output="screen"/>

   <node pkg="nodelet" type="nodelet" name="registration_pass_through" args="load pcl/PassThrough $(arg nodelet_manager)" output="screen">
    <remap from="~input" to="$(arg points_in)" />
    <rosparam>
      filter_field_name: z
      filter_limit_min: 0.0
      filter_limit_max: 5.0
      keep_organized: true
    </rosparam>
  </node>

  <node pkg="nodelet" type="nodelet" name="registration_nodelet" args="load cob_3d_registration/RegistrationNodelet $(arg nodelet_manager)" output="screen">

    <remap from="camera_info" to="/cam3d/rgb/camera_info"/>
    <!--remap from="point_cloud2" to="/cam3d/rgb/points"/-->
    <remap from="point_cloud2" to="/registration_pass_through/output"/>
    <remap from="point_cloud2_aligned" to="registration/pc_aligned"/>
    <remap from="reset" to="/registration/reset"/>

	<arg name="algo" value="frir" />
	<include  file="$(find cob_3d_registration)/ros/config/$(arg algo).xml" />

  </node>

</launch>
